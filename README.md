# create-blocks-dev-env
This simple HTTP server served as our development and testing environment. It showcases the functionality of created tool.

## Structure
```index.html``` contains the HTML body and loads all scripts to be served on server.

```grammar.js``` javascript grammar definition for Tree-Sitter parser (only for reference).

```http_...``` files with packaged Blockly libraries used in the application.

```tests\test.js``` contains test sets we used and gradually enriched during the development process.

```styles\index.css``` simple css style to give the web page some structure.

```scripts``` contains all .js files needed for application to work properly.

```scripts\tree-sitter-lua-final.wasm``` is a grammar/parser generated using ```tree-siiter-cli``` from ```grammar.js``` and which is loaded by Tree-Sitter parser. 

```scripts\tree-sitter.js``` is a standalone web-tree-sitter parser which we use instead of whole web-tree-sitter module.

```scripts\allBlocks.js``` defines all blocks which will be available to our tool.

```scripts\registerBlocks``` implements generators of blocks and their registering to Blockly Workspace.

```scritps\helpFunctions.js``` contains helpful functions used in our tool.

```scripts\main.js``` implements main functionality of our tool and simple UI for controlling the applications (few buttons and dropdown box). Implements main method createBlocks().

```scripts\toolbox.js``` this file was taken and altered a little by adding few custom blocks

```scripts\Classes``` contains ```Distributor``` directory with class of the same name responsible for distributing the workload to ```MyNode``` subclasses. Also contains all the subclasses of ```MyNode``` class in the directory with same name. These classes are responsible for creating blocks from nodes assigned to them.


## Running the simple local server
We can run the server by calling the following command in the root directory of the project (containing index.html):
```bash
python -m http.server 8001
```
By running this command we are serving the files and running the server. We can open it in our browser with following URL:
```url
http://localhost:8001
```

## Use
This tool was mainly implemented as development and testing environment, so its use is quite simple and it does not provide the greatest user experience. 

We can either build the Lua code by connecting blocks available in Toolbox onto the Blockly Workspace. To generate code from these blocks we can press the "Blocks to Code" button. This will write the code in console of the web browser development tool.

Or we can write code in the provided text area and then create block representaion by clicking "Code to Blocks" button. Notice: This process should support only blocks available in the toolbox and code/structures generated by them. If you find errors or tool does not work properly for some block from the toolbox, leave a comment.

"Init test button" serves to initalize test set which is selected in dropdown window. This process runs through all test snippets in test.js file associated with chosen set.

## Supported structures of Lua Code:
- Constants: numbers, strings, boolean values (false/true), nil, decimal numbers
- Variables and local variables
- Variable assignments: a = 1
- All arithmetic operations: +, -, *, /, ^, %
- Parenthesized arithmetic operations
- Unary operations: not, # (length of string or array) and numeric negate -a
- Concatenation of strings: a = "s" .. "s"
- Logic comparison: ==, ~=, <, >, <=, >=
- Logic operands: and, or
- Simple tables: empty = {}, array = {1, 2, 3}, matrix = {{1,2,3},{...},{...}}
- Indexing to array: array[1]
- Key statements: break and return
- if-elseif-else condition
- Numeric and Generic cycle
- While and Repeat cycle
- New function definitions and their calls
- Ternary operator: a = (x > y) and x or y, (only supported with variables)
- Functions from LOVE2D framework for which blocks are present in the toolbox
- Comments: -- This is commnt

## Currently unsupported structures of Lua Code:
- Matrix access: matrix[1][2]
- Dictionary: dictionary = {key = value}
- Indexing array with strings: a["key"]
- Iterators
- Local functions
- Modules
- Native functions of Lua
- Multiline comments and strings
- Comments in main block of code are ignored (to avoid their cyclic creation)

## Some notes about the functionality
- When defining function with return value, there must be return statement present in the main body of function. Otherwise the function wont be recognized as of return type.
- Variables and functions in code must be first initalized before we use them. Otherwise the block creation wont work. This also means that recirsive functions do not work for now.
- The transition from blocks to code and code to blocks is not in 1-to-1 relation, so blocks may look different. But their functionality should be the same.
- Careful about naming convention. Do not use same name twice.
- Generic cylce with ipairs() ignores this function as there is no block for her now. But the ipairs() is necessary in this cycle to create correct block. It should have array as parameter.
- Functions from Math, Text and Lists sections are troublesome and some of them do not function correctly without specificly correct code. One example are functions mathi.sin/cos/tan() which require to have argument in code passed in math.rad() function. It would look like this: math.sin(math.rad(50)).











